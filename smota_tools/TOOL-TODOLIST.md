# SMOTA Tool 开发任务清单

本文档记录 SMOTA 上位机工具的开发任务进度。

> **开发策略**：先实现纯串口工具 → 在此基础上添加 SMOTA 协议支持 → 最终完成上位机

---

## 开发环境配置

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 安装 Rust 工具链 | `rustc --version` 正常输出 | ✅ 已完成 (rustc 1.93.0) |
| P0 | 安装 Node.js (v18+) | `node -v` 显示 v18+ | ✅ 已完成 (v20.12.2) |
| P0 | 安装 Visual Studio C++ 生成工具 | 能成功编译 Tauri 项目 | ✅ 已完成 (VS 2026 Build Tools) |
| P0 | 安装 pnpm 包管理器 | `pnpm -v` 正常输出 | ✅ 已完成 (10.28.2) |
| P0 | 验证开发环境 | `cargo tauri info` 无错误 | ✅ 已完成 |
| P0 | 配置 VS 环境变量 | `cl.exe` 在任意终端可用 | ✅ 已完成 |

> **VS 环境配置说明**：
> - 用户安装的是 Visual Studio **2025** Build Tools (版本 18)，不是 2022
> - cl.exe 路径: `C:\Program Files (x86)\Microsoft Visual Studio\18\BuildTools\VC\Tools\MSVC\14.50.35717\bin\Hostx64\x64\cl.exe`
> - 建议将上述路径加入系统 PATH 环境变量，之后 `cl.exe` 在任意终端可直接使用

---

## 阶段一：纯串口工具（当前阶段）

### 项目初始化

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 使用 Tauri 脚手架创建项目 | 项目能 `pnpm install` && `pnpm dev` 启动 | ✅ 已完成 |
| P0 | 配置 Vue 3 + TypeScript 环境 | `.vue` 文件能使用 TS 类型 | ✅ 已完成 |
| P1 | 配置 Tailwind CSS | 组件能使用 Tailwind 样式 | ✅ 已完成 |
| P1 | 配置 Naive UI 组件库 | Naive 组件能正常渲染 | ✅ 已完成 |
| P0 | 初始化项目目录结构 | 目录结构符合规范 | ✅ 已完成 |
| P0 | 配置 Git 版本控制 | `git status` 正常工作 | ✅ 已完成 |

### Rust 后端 - 串口管理模块

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 实现串口列表获取命令 | 能列出系统所有可用串口 | ✅ 已完成 |
| P0 | 实现串口打开/关闭功能 | 打开串口后状态正确；关闭后资源释放 | ✅ 已完成 |
| P0 | 实现串口参数配置（波特率、数据位、停止位、校验位） | 不同参数组合下通信正常 | ✅ 已完成 |
| P0 | 实现数据发送功能 | 发送 ASCII/Hex 数据，接收端正确收到 | ✅ 已完成 |
| P0 | 实现异步数据接收 | 接收数据实时显示，无丢失 | ✅ 已完成 |
| P1 | 实现设备热插拔检测 | 插入/拔出设备时列表自动刷新 | ✅ 已完成 |
| P2 | 实现自动重连机制 | 断连后 N 秒内自动重连 | ⏳ 待开始 |

### 前端 UI - 串口工具界面

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 串口连接面板组件 | 能选择串口、点击连接/断开 | ✅ 已完成 |
| P0 | 串口参数设置组件 | 能配置波特率、数据位等参数 | ✅ 已完成 |
| P0 | 数据接收区域组件 | 接收数据实时滚动显示 | ✅ 已完成 |
| P0 | 数据发送区域组件 | 能输入并发送数据 | ✅ 已完成 |
| P0 | Hex/ASCII 显示切换 | 切换时数据正确转换 | ✅ 已完成 |
| P1 | 时间戳显示 | 每条数据前显示 HH:mm:ss.ms | ✅ 已完成 |
| P1 | 数据统计 | 显示发送/接收/错误计数 | ✅ 已完成 |
| P1 | 发送历史记录 | 发送过的命令记录在列表中 | ✅ 已完成 |

### 功能集成

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 串口连接状态管理 | UI 状态与后端状态一致 | ✅ 已完成 |
| P0 | 前后端事件通信测试 | 前后端消息传递正常 | ✅ 已完成 |
| P1 | 异常处理集成 | 错误有友好提示，不闪退 | ✅ 已完成 |

### 测试

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 串口模块单元测试 | `cargo test serial` 通过 | ⏳ 待开始 |
| P0 | 串口通信集成测试 | 连接真实设备收发数据正常 | ⏳ 待开始 |
| P0 | Windows 10/11 兼容性 | 在对应系统上正常运行 | ⏳ 待开始 |
| P1 | 不同串口芯片测试 | CH340/FTDI/CP2102 均能识别 | ⏳ 待开始 |
| P1 | 不同波特率测试 | 9600/115200 等常用波特率正常 | ⏳ 待开始 |

---

## 阶段二：添加 SMOTA 协议支持

### Rust 后端 - SMOTA 协议模块

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 定义 SMOTA 数据包结构 | 结构体定义符合协议规范 | ⏳ 暂时跳过 |
| P0 | 实现设备识别命令 | 能返回设备 ID/固件版本 | ⏳ 暂时跳过 |
| P0 | 实现固件信息读取 | 能读取固件大小、CRC 等信息 | ⏳ 暂时跳过 |
| P0 | 实现闪存擦除功能 | 擦除命令发送成功，返回 OK | ⏳ 暂时跳过 |
| P0 | 实现固件分块写入 | 能按块写入数据，无丢失 | ⏳ 暂时跳过 |
| P0 | 实现 CRC 校验功能 | CRC 计算与设备端一致 | ⏳ 暂时跳过 |
| P0 | 实现升级进度追踪 | 进度条 0-100% 正确显示 | ⏳ 暂时跳过 |
| P0 | 实现设备重启指令 | 升级完成后设备正常重启 | ⏳ 暂时跳过 |

### 前端 UI - OTA 升级界面

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | 固件包选择组件 | 能选择 `.bin` / `.hex` 文件 | ⏳ 暂时跳过 |
| P0 | 固件信息解析 | 显示固件大小、CRC 等信息 | ⏳ 暂时跳过 |
| P0 | 升级选项配置 | 能选择校验级别等选项 | ⏳ 暂时跳过 |
| P0 | 升级进度条 | 进度条随升级进度更新 | ⏳ 暂时跳过 |
| P0 | 升级日志显示 | 显示擦除/写入/验证各阶段日志 | ⏳ 暂时跳过 |
| P0 | 升级结果提示 | 成功/失败显示明确提示 | ⏳ 暂时跳过 |
| P0 | OTA 升级流程整合 SMOTA 协议 | 一键完成完整升级流程 | ⏳ 暂时跳过 |
| P0 | OTA 升级流程测试 | 完整升级流程成功 | ⏳ 暂时跳过 |

### 功能集成

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P0 | SMOTA 协议单元测试 | `cargo test smota` 通过 | ⏳ 暂时跳过 |

---

## 阶段三：高级功能（可选）

### Python 脚本模块

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P1 | 配置 Pyo3 依赖 | Rust 项目能编译 Python 扩展 | ⏳ 暂时跳过 |
| P1 | 实现脚本加载功能 | 能加载 `.py` 文件并解析 | ⏳ 暂时跳过 |
| P1 | 实现 `calculate()` 函数调用 | 脚本返回结果能传递到前端 | ⏳ 暂时跳过 |
| P2 | 实现脚本沙箱限制 | 恶意脚本不会影响主程序 | ⏳ 暂时跳过 |
| P1 | 实现错误处理与反馈 | 脚本错误显示在 UI 上 | ⏳ 暂时跳过 |
| P2 | 编写 Python API 文档 | 有 `calculate(data: str) -> str` 使用说明 | ⏳ 暂时跳过 |
| P1 | 发送数据流程整合 Python 脚本 | 发送前能经过脚本处理 | ⏳ 暂时跳过 |

### 高级 UI 功能

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P1 | 深色/浅色主题切换 | 主题切换生效，状态持久化 | ⏳ 暂时跳过 |
| P2 | 集成 Monaco Editor | 代码编辑区域正常显示 | ⏳ 暂时跳过 |
| P2 | Python 语法高亮 | 关键字有颜色区分 | ⏳ 暂时跳过 |
| P2 | 代码自动补全 | 敲代码时弹出补全建议 | ⏳ 暂时跳过 |
| P1 | 脚本保存/加载功能 | 保存后能重新加载 | ⏳ 暂时跳过 |
| P2 | 脚本示例模板 | 有可运行的 Hello World 示例 | ⏳ 暂时跳过 |
| P1 | 数据导出功能 | 能导出 CSV/hex 文件 | ⏳ 暂时跳过 |
| P2 | 历史记录保存 | 退出后再次打开仍保留 | ⏳ 暂时跳过 |
| P2 | 历史记录导入导出 | 能导出/导入历史文件 | ⏳ 暂时跳过 |
| P2 | 集成 ECharts | 图表组件正常渲染 | ⏳ 暂时跳过 |
| P2 | 实时数据波形显示 | 接收数据以波形显示，无明显延迟 | ⏳ 暂时跳过 |
| P3 | 信号强度图表 | 图表能正确反映信号变化 | ⏳ 暂时跳过 |
| P3 | 错误率统计 | 错误次数以图表展示 | ⏳ 暂时跳过 |

### 打包发布

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P1 | 配置 NSIS 安装包 | 能生成安装程序 | ⏳ 暂时跳过 |
| P2 | 配置代码签名 | 安装包签名有效 | ⏳ 暂时跳过 |
| P1 | Windows MSI 打包 | MSI 安装包可正常安装 | ⏳ 暂时跳过 |
| P1 | 安装包测试 | 安装后能正常启动运行 | ⏳ 暂时跳过 |
| P2 | 自动更新功能测试 | 能检测并下载新版本 | ⏳ 暂时跳过 |
| P1 | 编写发布说明 | 有版本特性说明文档 | ⏳ 暂时跳过 |

### 文档编写

| 优先级 | 任务 | 验证目标 | 状态 |
|--------|------|----------|------|
| P1 | API 接口文档 | 前后端 API 有说明文档 | ⏳ 暂时跳过 |
| P1 | 用户使用手册 | 有串口通信、OTA 升级使用说明 | ⏳ 暂时跳过 |
| P2 | Python 脚本编写指南 | 有脚本 API 和示例 | ⏳ 暂时跳过 |
| P2 | 常见问题 FAQ | 常见问题有解答 | ⏳ 暂时跳过 |
| P1 | 更新日志 | 每次发版有更新记录 | ⏳ 暂时跳过 |

---

## 开发进度总览

| 阶段 | 状态 | 进度 |
|------|------|------|
| 开发环境配置 | ✅ 已完成 | 100% |
| **阶段一：纯串口工具** | ✅ 已完成 | 100% |
| 阶段二：SMOTA 协议支持 | ⏳ 暂时跳过 | 0% |
| 阶段三：高级功能 | ⏳ 暂时跳过 | 0% |

> **开发文档**: 详见 `doc/` 目录
> - `01-project-initialization.md` - 项目初始化说明
> - `02-serial-port-module.md` - 串口模块开发说明

---

## 优先级说明

| 优先级 | 说明 |
|--------|------|
| P0 | 核心功能，必须完成，否则工具不可用 |
| P1 | 重要功能，建议完成，提升用户体验 |
| P2 | 增强功能，可选完成，丰富功能场景 |
| P3 | 锦上添花，资源充裕时完成 |

## 暂时跳过说明

标记为 "⏳ 暂时跳过" 的任务将在后续阶段中根据需要启用，当前阶段专注于完成纯串口工具的核心功能。

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2025-01-30 | v1.0 | 创建任务清单 |
| 2025-01-31 | v1.1 | 添加优先级标记和验证目标列 |
| 2025-01-31 | v1.2 | 开发环境验证完成：Rust 1.93.0、Node.js v20.12.2、pnpm 10.28.2、VS 2025 Build Tools；更新 VS 环境配置说明 |
| 2025-01-31 | v1.3 | 调整开发策略：分阶段实现，先完成纯串口工具，再添加 SMOTA 协议支持；标记后续阶段任务为"暂时跳过" |
| 2025-01-31 | v1.4 | **阶段一完成**：实现 Hex/ASCII 显示切换、时间戳显示、数据统计、发送历史记录、异常处理集成、设备热插拔检测 |
