# SMOTA Tool 使用指南

> 本文档介绍如何打包、运行和测试 SMOTA Tool 串口调试工具

## 目录

1. [快速开始](#快速开始)
2. [打包成 EXE](#打包成-exe)
3. [运行应用](#运行应用)
4. [功能测试](#功能测试)
5. [常见问题](#常见问题)

---

## 快速开始

### 方式一：直接运行（开发模式）

如果只需要临时测试，可以使用开发模式运行：

```bash
cd smota_tools/serial-tool
pnpm dev
```

这会启动一个窗口，显示串口调试工具。但这种方式需要 Node.js 环境，不适合分发。

### 方式二：打包成 EXE（推荐）

打包后生成独立的 EXE 文件，无需安装任何依赖，直接双击即可运行。

---

## 打包成 EXE

### 前置条件

确保已安装以下软件：

1. **Rust** - https://rustup.rs/
   - 安装时选择默认选项
   - 安装完成后重启终端

2. **Node.js** (v18+) - https://nodejs.org/
   - 下载 LTS 版本并安装

3. **Visual Studio Build Tools**
   - Windows 用户需要安装 C++ 构建工具
   - 运行 `winget install Microsoft.VisualStudio.2022.BuildTools` 或从 https://visualstudio.microsoft.com/visual-cpp-build-tools/ 下载

### 步骤

#### 1. 安装依赖

```bash
# 进入项目目录
cd smota_tools/serial-tool

# 安装 Node.js 依赖
pnpm install
```

#### 2. 构建前端

```bash
pnpm build
```

#### 3. 打包 Windows EXE

```bash
# 进入 Tauri 目录
cd src-tauri

# 清理并构建发布版本
cargo tauri build
```

#### 4. 获取 EXE 文件

打包成功后，EXE 文件位于：

```
smota_tools/serial-tool/src-tauri/target/release/bundle/msi/Serial Tool_0.1.0_x64.msi
```

或者：

```
smota_tools/serial-tool/src-tauri/target/release/bundle/nsis/Serial Tool-0.1.0-setup.exe
```

---

## 运行应用

### 安装版（推荐）

1. 双击 `Serial Tool-0.1.0-setup.exe`
2. 按照向导完成安装
3. 在开始菜单或桌面找到 "Serial Tool" 图标
4. 双击启动

### 便携版

如果你生成了 ZIP 便携版：

1. 解压到任意目录
2. 双击 `Serial Tool.exe` 即可运行

---

## 功能测试

### 测试清单

在测试前，请准备：
- 一台 Windows 10/11 电脑
- 一个 USB 转 TTL 串口模块（如 CH340、CP2102）
- 一根 USB 数据线

#### 测试 1：启动应用

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 双击图标启动应用 | 窗口正常打开，无报错 |
| 2 | 检查窗口标题 | 显示"串口调试工具" |
| 3 | 观察界面 | 显示串口连接区和数据收发区 |

#### 测试 2：加载串口列表

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"刷新"按钮 | 列出可用串口（如 COM3、COM4） |
| 2 | 插入串口设备 | 点击刷新后显示新设备 |
| 3 | 拔出串口设备 | 点击刷新后设备消失 |

#### 测试 3：连接串口

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 选择一个串口 | 下拉框显示设备名称 |
| 2 | 点击"连接"按钮 | 按钮变为"断开"，显示绿色 |
| 3 | 检查状态栏 | 显示"已连接到 COMx" |

#### 测试 4：发送数据（需要 loopback 或对端设备）

**Loopback 测试方法：**
将串口的 TX 和 RX 短接（发送什么接收什么）

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 在发送区输入 "Hello" | 输入框显示文本 |
| 2 | 点击"发送"按钮 | 发送计数增加 |
| 3 | 观察接收区 | 收到 "Hello"（如果是 loopback） |

#### 测试 5：Hex 模式测试

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 勾选"Hex 显示" | 接收区显示 48 65 6C 6C 6F |
| 2 | 勾选"Hex 发送" | 输入框提示变为十六进制输入 |
| 3 | 输入 "48 65 6C 6C 6F" | 能正常发送 |
| 4 | 发送后取消勾选 | 恢复正常文本模式 |

#### 测试 6：时间戳测试

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 勾选"时间戳" | 接收数据显示时间戳 [HH:mm:ss.ms] |
| 2 | 取消勾选 | 时间戳消失 |

#### 测试 7：发送历史测试

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送几条不同数据 | 历史记录显示发送内容 |
| 2 | 点击历史记录 | 内容自动填入发送框 |
| 3 | 点击"清空" | 历史记录被清空 |

#### 测试 8：热插拔测试

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 连接串口设备 | 正常通信 |
| 2 | 拔出设备（不点击断开） | 2秒后弹出警告"串口设备已断开" |
| 3 | 自动断开 | 按钮恢复为"连接"状态 |

#### 测试 9：数据统计测试

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送 100 字节 | 发送统计显示 100 B |
| 2 | 接收 50 字节 | 接收统计显示 50 B |
| 3 | 制造错误 | 错误统计增加 |

#### 测试 10：关闭应用

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"断开"按钮 | 断开连接 |
| 2 | 关闭窗口 | 程序正常退出 |
| 3 | 重新打开 | 能正常启动 |

---

## 常见问题

### Q1: 打包失败，提示缺少 C++ 工具

**解决方法：**
```bash
# 使用 winget 安装（推荐）
winget install Microsoft.VisualStudio.2022.BuildTools

# 或者从官网下载
# https://visualstudio.microsoft.com/visual-cpp-build-tools/
```

### Q2: 运行时提示找不到 DLL

**解决方法：**
- 确保已安装 Visual C++ Redistributable
- 下载地址：https://aka.ms/vs/17/release/vc_redist.x64.exe

### Q3: 串口列表为空

**可能原因：**
1. 没有插入串口设备
2. 设备驱动未安装
3. 设备被其他程序占用

**解决方法：**
- 插入设备后等待几秒
- 安装 CH340/CP2102 驱动
- 关闭占用串口的程序

### Q4: 发送数据无响应

**可能原因：**
1. TX/RX 接反
2. 波特率不匹配
3. 设备不支持该数据格式

**解决方法：**
- 检查接线（TX 接 RX，RX 接 TX）
- 确认双方波特率一致
- 尝试 Hex 模式发送

### Q5: 杀毒软件报毒

**说明：**
- Tauri 应用首次打包可能被误报
- 这是因为 EXE 是新的、未签名的程序

**解决方法：**
- 添加信任
- 或使用代码签名证书签名（企业版功能）

### Q6: 应用界面显示不全

**解决方法：**
- 按 `Win + 方向键` 调整窗口大小
- 修改显示缩放设置为 100%

---

## 技术支持

如遇到问题，请：

1. 查看控制台错误信息
2. 截屏保存错误信息
3. 记录操作步骤
4. 联系开发者

---

## 版本信息

| 信息 | 值 |
|------|-----|
| 应用名称 | Serial Tool |
| 版本 | 0.1.0 |
| 基于框架 | Tauri 2.x + Vue 3 |
| 支持系统 | Windows 10/11 (64位) |

---

*文档版本: v1.0*
*最后更新: 2025-01-31*
